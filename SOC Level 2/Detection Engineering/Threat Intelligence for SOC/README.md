# TryHackMe Room: Threat Intelligence for SOC

This room focused on the practical application of Threat Intelligence (TI) within a Security Operations Center. I learned how to consume TI feeds, convert Indicators of Compromise (IOCs) into searchable queries using tools like Uncoder.io, and use the Elastic Stack to detect and prevent threats using mechanisms like DNS Sinkholing.

---

## Section: Threat Intelligence Feeds

### Task 1: How many unique IP addresses were provided in the IOC list?

To answer this, I first needed to convert the provided raw list of IOCs into a format usable by Kibana. I went to Uncoder.io and converted the ioc_list into an Elastic Query. The resulting query looked like this:

destination.ip:("135.181.103.89" OR "185.224.126.215" OR "185.224.128.215" OR "171.24.136.15" OR "171.22.136.15" OR "195.133.40.108" OR "103.190.37.169" OR "103.170.37.169" OR "103.190.37.169" OR "185.224.128.215" OR "107.175.202.151" OR "107.175.202.158" OR "195.133.40.108" OR "107.175.202.158" OR "109.206.240.194")

I set the time range according to the task instructions and pasted the query into Kibana. Before running the search, I manually counted the unique IP addresses in the query list, resulting in 11.

### Task 2: Based on the set of IOCs, how many IOC hits were discovered in the logs?

After running the generated query in Kibana, the total number of hits (events matching the IOCs) was displayed at the top of the interface.

[Screenshot 01: Total IOC hits in logs](./screenshots/01-total-hits.png)

### Task 3: Out of the total number of IOCs, how many unique IP addresses were discovered in the logs?

To see how many specific IPs from my list were actually active in the logs, I clicked on the destination.ip field and selected Visualize. The chart showed 5 distinct IP bars and one bar labeled "Other" containing 2 more IPs.

Total unique IPs found: 5 + 2 = 7.

[Screenshot 02: Visualizing unique destination IPs](./screenshots/02-unique-dest-ips.png)

[Screenshot 03: Other unique IPs in visualization](./screenshots/03-other-ips.png)

### Task 4: How many connections were made to 185[.]224[.]128[.]215?

I filtered the results specifically for the IP 185.224.128.215. The total hit count for this specific IP was the answer.

[Screenshot 04: Connection count for specific IP](./screenshots/04-connection-count.png)

### Task 5: What is the IP address of the compromised host?

To identify the victim machine on the network, I looked at the source.ip field in the logs correlating to the malicious traffic.

[Screenshot 05: Source IP of compromised host](./screenshots/05-compromised-host-ip.png)

### Task 6: What is the destination port of connections made to 107[.]175[.]202[.]151?

I filtered for events involving the destination IP 107.175.202.151 and then checked the destination.port field. The traffic was directed to port 80.

[Screenshot 06: Destination port for specific IP](./screenshots/06-dest-port.png)

---

## Section: Intelligence-driven Prevention

### Task 1: How many DNS queries to agrosaoxe[.]info have been created?

I used a KQL query to search specifically for DNS requests to the malicious domain.

dns.question.name : "agrosaoxe.info"

[Screenshot 07: DNS query count for agrosaoxe.info](./screenshots/07-dns-query-count.png)

### Task 2: Before deploying the sinkhole configuration, what IPv4 addresses are resolved by agrosaoxe[.]info? (format: IPs in ascending order)

To find the actual IP addresses the domain resolved to before intervention, I clicked on the dns.resolved_ip field and visualized the data. The IPs were 104.21.48.143 and 172.67.186.179.

[Screenshot 08: Resolved IPs before sinkhole](./screenshots/08-resolved-ips.png)

### Task 3: What is the IP address used for DNS Sinkhole?

Looking at the previous visualization/logs, I identified the internal IP used to redirect malicious traffic (the sinkhole). It was 192.168.5.13.

### Task 4: How many hits were caused by connections to sinkholed domains?

To count how many times the sinkhole successfully intercepted traffic, I queried for the sinkhole IP in the DNS answers.

dns.answers.data: "192.168.5.13"

[Screenshot 09: Hits to sinkhole IP](./screenshots/09-sinkhole-hits.png)

### Task 5: How many unique domains have been sinkholed?

Using the query from the previous task, I visualized the dns.question.name field. I adjusted the visualization settings to show the top 30 results to ensure I didn't miss any. The count of unique domains was 12.

[Screenshot 10: Count of unique sinkholed domains](./screenshots/10-unique-sinkholed-domains.png)

---

## Section: Intelligence-driven Detection

### Task 1: What is the value of the alert field in the converted ElastAlert rule?

I reviewed the converted rule configuration provided in the task. The alert field was set to debug.

### Task 2: How many alerts were generated by the rule?

After running the detection rule, I checked the output to see the total number of alerts generated.

[Screenshot 11: Total alerts generated](./screenshots/11-alerts-generated.png)

### Task 3: How many unique domains were sinkholed via 0.0.0.0?

Sometimes sinkholes use 0.0.0.0 instead of a specific internal IP. I updated my query to search for this address:

dns.answers.data: "0.0.0.0"

Then, I visualized the dns.question.name field to count the unique domains.

### Task 4: What is the sinkholed domain that has .ru TLD?

To find the specific Russian domain, I used command-line tools on the output file containing the alerts.

cat output.txt | grep .ru

The domain was twizt.ru.

---

# Summary

In this room, I practiced the full lifecycle of using Threat Intelligence in a SOC:

- Consumption: Taking a raw list of IOCs (IPs and Domains).
- Transformation: Using Uncoder.io to convert raw IOCs into KQL queries.
- Prevention: Analyzing DNS Sinkholing logs to verify that malicious domains are being intercepted.
- Detection: Working with ElastAlert rules to automate the detection of sinkholed traffic.



